<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>How to Setup an RPM Signing Key - Giovanni Torres</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://giovannitorres.me/how-to-setup-an-rpm-signing-key.html">

        <meta name="author" content="Giovanni Torres" />
        <meta name="keywords" content="rpm,gpg" />
        <meta name="description" content="Introduction In Part 1 of this series, we set up an RPM build environment with a dedicated user for building RPMs. Before we actually walk through the steps for building an RPM, we need to create a GPG key to sign the RPMs before they are distributed and installed. Signing ..." />

        <meta property="og:site_name" content="Giovanni Torres" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="How to Setup an RPM Signing Key"/>
        <meta property="og:url" content="http://giovannitorres.me/how-to-setup-an-rpm-signing-key.html"/>
        <meta property="og:description" content="Introduction In Part 1 of this series, we set up an RPM build environment with a dedicated user for building RPMs. Before we actually walk through the steps for building an RPM, we need to create a GPG key to sign the RPMs before they are distributed and installed. Signing ..."/>
        <meta property="article:published_time" content="2015-05-29" />
            <meta property="article:section" content="RPM" />
            <meta property="article:tag" content="rpm" />
            <meta property="article:tag" content="gpg" />
            <meta property="article:author" content="Giovanni Torres" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://giovannitorres.me/theme/css/bootstrap.cosmo.min.css" type="text/css"/>
    <link href="http://giovannitorres.me/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://giovannitorres.me/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://giovannitorres.me/theme/css/style.css" type="text/css"/>
        <link href="http://giovannitorres.me/static/custom.css" rel="stylesheet">

        <link href="http://giovannitorres.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Giovanni Torres ATOM Feed"/>



        <link href="http://giovannitorres.me/feeds/rpm.atom.xml" type="application/atom+xml" rel="alternate"
              title="Giovanni Torres RPM ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://giovannitorres.me/" class="navbar-brand">
Giovanni Torres            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://giovannitorres.me/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://giovannitorres.me/how-to-setup-an-rpm-signing-key.html"
                       rel="bookmark"
                       title="Permalink to How to Setup an RPM Signing Key">
                        How to Setup an RPM Signing Key
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2015-05-29T13:47:00-04:00"> Fri 29 May 2015</time>
    </span>

            <span class="label label-default">Series</span>
            Part 2 of Building RPMs




<span class="label label-default">Tags</span>
	<a href="http://giovannitorres.me/tag/rpm.html">rpm</a>
        /
	<a href="http://giovannitorres.me/tag/gpg.html">gpg</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <h2>Introduction</h2>
<p>In <a href="http://giovannitorres.me/how-to-setup-an-rpm-build-environment-on-centos-6.html">Part 1</a> of
this series, we set up an RPM build environment with a dedicated user for
building RPMs.  </p>
<p>Before we actually walk through the steps for building an RPM, we need to
create a GPG key to sign the RPMs before they are distributed and installed.
Signing RPMs is a good practice and ensures all the installed RPMs in your
environment are verified from trusted sources.</p>
<p>In this guide, we will walk through the steps required to create your own RPM
GPG signing key, distribute it and import it into a machine's RPM database.</p>
<h2>Prerequisites</h2>
<p>Creating a GPG key requires a certain amount of entropy in order to ensure
sufficient randomness.  If you are following this guide on a virtual machine,
you will need to make sure that the virtual machine has sufficient entropy.</p>
<p>See this <a href="http://giovannitorres.me/increasing-entropy-on-virtual-machines.html">post</a> on how to
increase the entropy on your virtual machine using <em>rng-tools</em> before
continuing.</p>
<p>Additionally, the steps in this guide will be carried out by the <strong>makerpm</strong>
user.</p>
<h2>Install Packages</h2>
<p>To install the GPG package, run the following:</p>
<div class="highlight"><pre><span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">gnupg2</span>
</pre></div>


<h2>Create a GPG Key Pair</h2>
<p>Use the <em>gpg</em> command to create a new key pair:</p>
<div class="highlight"><pre><span class="n">gpg</span> <span class="o">--</span><span class="n">gen</span><span class="o">-</span><span class="n">key</span>
</pre></div>


<p>The <strong>--gen-key</strong> option is used interactively.  Select the key you want to use.
The first option, <em>RSA and RSA</em>, creates an RSA key for digital signing and
another RSA key for encryption.</p>
<div class="highlight"><pre><span class="n">Please</span> <span class="n">select</span> <span class="n">what</span> <span class="n">kind</span> <span class="n">of</span> <span class="n">key</span> <span class="n">you</span> <span class="n">want</span><span class="o">:</span>
   <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">RSA</span> <span class="n">and</span> <span class="n">RSA</span> <span class="p">(</span><span class="k">default</span><span class="p">)</span>
   <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">DSA</span> <span class="n">and</span> <span class="n">Elgamal</span>
   <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">DSA</span> <span class="p">(</span><span class="n">sign</span> <span class="n">only</span><span class="p">)</span>
   <span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">RSA</span> <span class="p">(</span><span class="n">sign</span> <span class="n">only</span><span class="p">)</span>
<span class="n">Your</span> <span class="n">selection</span><span class="o">?</span> <span class="mi">1</span>
</pre></div>


<p>Next, select the size.  The default <em>2048</em> bits are sufficient, but if you are
feeling particularly paranoid, go for <em>4096</em> bits.</p>
<div class="highlight"><pre><span class="n">RSA</span> <span class="n">keys</span> <span class="n">may</span> <span class="n">be</span> <span class="n">between</span> <span class="mi">1024</span> <span class="n">and</span> <span class="mi">4096</span> <span class="n">bits</span> <span class="kt">long</span><span class="p">.</span>
<span class="n">What</span> <span class="n">keysize</span> <span class="k">do</span> <span class="n">you</span> <span class="n">want</span><span class="o">?</span> <span class="p">(</span><span class="mi">2048</span><span class="p">)</span> <span class="mi">2048</span>
<span class="n">Requested</span> <span class="n">keysize</span> <span class="n">is</span> <span class="mi">2048</span> <span class="n">bits</span>
</pre></div>


<p>Next, choose how long the key should be valid.  In this example, we choose the
default choice, <em>0</em>, so the key will not expire.</p>
<div class="highlight"><pre><span class="nx">Please</span> <span class="nx">specify</span> <span class="nx">how</span> <span class="nx">long</span> <span class="nx">the</span> <span class="nb">key</span> <span class="nx">should</span> <span class="nx">be</span> <span class="nx">valid.</span>
         <span class="mi">0</span> <span class="o">=</span> <span class="nb">key</span> <span class="nx">does</span> <span class="ow">not</span> <span class="nb">expire</span>
      <span class="o">&lt;</span><span class="nb">n</span><span class="o">&gt;</span>  <span class="o">=</span> <span class="nb">key</span> <span class="n">expires</span> <span class="k">in</span> <span class="nb">n</span> <span class="nb">days</span>
      <span class="o">&lt;</span><span class="nb">n</span><span class="o">&gt;</span><span class="n">w</span> <span class="o">=</span> <span class="nb">key</span> <span class="n">expires</span> <span class="k">in</span> <span class="nb">n</span> <span class="nx">weeks</span>
      <span class="o">&lt;</span><span class="nb">n</span><span class="o">&gt;</span><span class="n">m</span> <span class="o">=</span> <span class="nb">key</span> <span class="n">expires</span> <span class="k">in</span> <span class="nb">n</span> <span class="nx">months</span>
      <span class="o">&lt;</span><span class="nb">n</span><span class="o">&gt;</span><span class="n">y</span> <span class="o">=</span> <span class="nb">key</span> <span class="n">expires</span> <span class="k">in</span> <span class="nb">n</span> <span class="nx">years</span>
<span class="nb">Key</span> <span class="nx">is</span> <span class="nb">valid</span> <span class="nb">for</span><span class="o">?</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> 
<span class="nb">Key</span> <span class="nx">does</span> <span class="ow">not</span> <span class="nb">expire</span> <span class="nx">at</span> <span class="kc">all</span>
<span class="nx">Is</span> <span class="nx">this</span> <span class="nx">correct</span><span class="o">?</span> <span class="p">(</span><span class="nx">y</span><span class="p">/</span><span class="nb">N</span><span class="p">)</span> <span class="nx">y</span>
</pre></div>


<p>Now, you will need to fill out some identifying information about the key, like
your name and email.  In this example, we leave the <em>Comment</em> field empty.
After filling out the fields, you are prompted to confirm the information or
change any of the fields before continuing.</p>
<div class="highlight"><pre><span class="n">GnuPG</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">construct</span> <span class="n">a</span> <span class="n">user</span> <span class="n">ID</span> <span class="n">to</span> <span class="n">identify</span> <span class="n">your</span> <span class="n">key</span><span class="p">.</span>

<span class="n">Real</span> <span class="n">name</span><span class="o">:</span> <span class="n">Example</span> <span class="n">Org</span> <span class="n">Signing</span> <span class="n">Key</span>
<span class="n">Email</span> <span class="n">address</span><span class="o">:</span> <span class="n">support</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>
<span class="nl">Comment:</span> 
<span class="n">You</span> <span class="n">selected</span> <span class="n">this</span> <span class="n">USER</span><span class="o">-</span><span class="n">ID</span><span class="o">:</span>
    <span class="s">&quot;Example Org Signing Key &lt;support@example.com&gt;&quot;</span>

<span class="n">Change</span> <span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="n">ame</span><span class="p">,</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="n">omment</span><span class="p">,</span> <span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="n">mail</span> <span class="n">or</span> <span class="p">(</span><span class="n">O</span><span class="p">)</span><span class="n">kay</span><span class="o">/</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span><span class="n">uit</span><span class="o">?</span> <span class="n">o</span>
</pre></div>


<p>The last step in creating the key pair is to protect your secret key with a
passphrase.  Note the use of a suggested passphrase and not a password.  We
recommend using an easy to remember sentence to protect the secret key.</p>
<p>You should now be presented with a curses based prompt to enter and confirm
your passphrase.</p>
<div class="highlight"><pre><span class="err">┌─────────────────────────────────────────────────────┐</span>
<span class="err">│</span> <span class="nx">Enter</span> <span class="nx">passphrase</span>                                    <span class="err">│</span>
<span class="err">│</span>                                                     <span class="err">│</span>
<span class="err">│</span>                                                     <span class="err">│</span>
<span class="err">│</span> <span class="nx">Passphrase</span> <span class="nx">________________________________________</span> <span class="err">│</span>
<span class="err">│</span>                                                     <span class="err">│</span>
<span class="err">│</span>   <span class="o">&lt;</span><span class="nx">OK</span><span class="o">&gt;</span>                             <span class="o">&lt;</span><span class="nb">Cancel</span><span class="o">&gt;</span>         <span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────┘</span>
</pre></div>


<p>This passphrase prompt is displayed by the <em>pinentry</em> package. If you are in an
X environment, whether on a desktop or via SSH with X11 forwarding enabled to a
remote server, you may get a GUI version of the passphrase prompt.  To get the
GUI prompt, however, you will need to have the <em>pinentry-gtk</em> package installed
if you are using GNOME and <em>pinentry-qt</em> or <em>pinentry-qt4</em> if you are using KDE.</p>
<p>After typing your password, the key generation may stall and you may see the following message:</p>
<div class="highlight"><pre><span class="n">We</span> <span class="n">need</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">a</span> <span class="n">lot</span> <span class="n">of</span> <span class="n">random</span> <span class="n">bytes</span><span class="p">.</span> <span class="n">It</span> <span class="n">is</span> <span class="n">a</span> <span class="n">good</span> <span class="n">idea</span> <span class="n">to</span> <span class="n">perform</span>
<span class="n">some</span> <span class="n">other</span> <span class="n">action</span> <span class="p">(</span><span class="n">type</span> <span class="n">on</span> <span class="n">the</span> <span class="n">keyboard</span><span class="p">,</span> <span class="n">move</span> <span class="n">the</span> <span class="n">mouse</span><span class="p">,</span> <span class="n">utilize</span> <span class="n">the</span>
<span class="n">disks</span><span class="p">)</span> <span class="n">during</span> <span class="n">the</span> <span class="n">prime</span> <span class="n">generation</span><span class="p">;</span> <span class="n">this</span> <span class="n">gives</span> <span class="n">the</span> <span class="n">random</span> <span class="n">number</span>
<span class="n">generator</span> <span class="n">a</span> <span class="n">better</span> <span class="n">chance</span> <span class="n">to</span> <span class="n">gain</span> <span class="n">enough</span> <span class="n">entropy</span><span class="p">.</span>
</pre></div>


<p>This has to do with insufficient entropy.  Again, see this
<a href="http://giovannitorres.me/increasing-entropy-on-virtual-machines.html">post</a> on how to increase
the entropy on your virtual machine.  You may open another terminal to the
server you are generating the keys on and install and run <em>rng-tools</em>.  Shortly
after the <em>rngd</em> daemon is running, the key generation should complete and you should see a message like this:</p>
<div class="highlight"><pre>gpg: key 3D832D1E marked as ultimately trusted
public and secret key created and signed.

gpg: checking the trustdb
gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u
pub   2048R/3D832D1E 2015-05-29
      Key fingerprint = 7F50 5CA9 0CD0 DBF1 FAC2  AB46 E5E5 4444 3D83 2D1E
uid                  Example Org Signing Key &lt;support@example.com&gt;
sub   2048R/D4F51F8B 2015-05-29
</pre></div>


<h2>Confirming your keys</h2>
<p>To list your keys, run the following command:</p>
<div class="highlight"><pre><span class="n">gpg</span> <span class="o">--</span><span class="n">list</span><span class="o">-</span><span class="n">keys</span>
</pre></div>


<p>You will see a listing of all keys.  In this example, only a single key is listed, the one we just created from the above steps.</p>
<div class="highlight"><pre>/home/makerpm/.gnupg/pubring.gpg
---------------------------------
pub   2048R/3D832D1E 2015-05-29
uid                  Example Org Signing Key &lt;support@example.com&gt;
sub   2048R/D4F51F8B 2015-05-29
</pre></div>


<h2>Troubleshooting TTY Issues</h2>
<p>There is an <a href="https://bugzilla.redhat.com/show_bug.cgi?id=659512#c5">issue</a>,
apparently with the <em>gnupg2</em> package, where if you <em>su</em>, i.e. switch, to
another user, a new pseudo-terminal is not opened for the switched user.</p>
<p>This causes problems since gnupg2 requires permissions to open a tty for the
<em>pinentry</em> package, which is responsible for displaying the passphrase prompt
to the screen. Therefore, if you run the <strong>gpg --gen-key</strong> command after
switching to a different user, you may see one of the following error messages:</p>
<p>Without X11 Forwarding:</p>
<div class="highlight"><pre><span class="n">gpg</span><span class="o">-</span><span class="n">agent</span><span class="p">[</span><span class="mi">5569</span><span class="p">]</span><span class="o">:</span> <span class="n">directory</span> <span class="err">`</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">makerpm</span><span class="o">/</span><span class="p">.</span><span class="n">gnupg</span><span class="o">/</span><span class="n">private</span><span class="o">-</span><span class="n">keys</span><span class="o">-</span><span class="n">v1</span><span class="p">.</span><span class="n">d</span><span class="err">&#39;</span> <span class="n">created</span>
<span class="n">gpg</span><span class="o">-</span><span class="n">agent</span><span class="p">[</span><span class="mi">5569</span><span class="p">]</span><span class="o">:</span> <span class="n">command</span> <span class="n">get_passphrase</span> <span class="n">failed</span><span class="o">:</span> <span class="n">Operation</span> <span class="n">cancelled</span>
<span class="nl">gpg:</span> <span class="n">cancelled</span> <span class="n">by</span> <span class="n">user</span>
<span class="nl">gpg:</span> <span class="n">Key</span> <span class="n">generation</span> <span class="n">canceled</span><span class="p">.</span>
</pre></div>


<p>With X11 Forwarding:</p>
<div class="highlight"><pre><span class="n">X11</span> <span class="n">connection</span> <span class="n">rejected</span> <span class="n">because</span> <span class="n">of</span> <span class="n">wrong</span> <span class="n">authentication</span><span class="p">.</span>
<span class="nl">xprop:</span>  <span class="n">unable</span> <span class="n">to</span> <span class="n">open</span> <span class="n">display</span> <span class="err">&#39;</span><span class="n">localhost</span><span class="o">:</span><span class="mf">10.0</span><span class="err">&#39;</span>
<span class="n">X11</span> <span class="n">connection</span> <span class="n">rejected</span> <span class="n">because</span> <span class="n">of</span> <span class="n">wrong</span> <span class="n">authentication</span><span class="p">.</span>

<span class="p">(</span><span class="n">pinentry</span><span class="o">-</span><span class="n">gtk</span><span class="o">-</span><span class="mi">2</span><span class="o">:</span><span class="mi">10602</span><span class="p">)</span><span class="o">:</span> <span class="n">Gtk</span><span class="o">-</span><span class="n">WARNING</span> <span class="o">**:</span> <span class="n">cannot</span> <span class="n">open</span> <span class="n">display</span><span class="o">:</span> <span class="n">localhost</span><span class="o">:</span><span class="mf">10.0</span>
<span class="n">gpg</span><span class="o">-</span><span class="n">agent</span><span class="p">[</span><span class="mi">10601</span><span class="p">]</span><span class="o">:</span> <span class="n">can</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">connect</span> <span class="n">server</span><span class="o">:</span> <span class="n">ec</span><span class="o">=</span><span class="mf">4.16383</span>
<span class="n">gpg</span><span class="o">-</span><span class="n">agent</span><span class="p">[</span><span class="mi">10601</span><span class="p">]</span><span class="o">:</span> <span class="n">can</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">connect</span> <span class="n">to</span> <span class="n">the</span> <span class="n">PIN</span> <span class="n">entry</span> <span class="n">module</span><span class="o">:</span> <span class="n">End</span> <span class="n">of</span> <span class="n">file</span>
<span class="n">gpg</span><span class="o">-</span><span class="n">agent</span><span class="p">[</span><span class="mi">10601</span><span class="p">]</span><span class="o">:</span> <span class="n">command</span> <span class="n">get_passphrase</span> <span class="n">failed</span><span class="o">:</span> <span class="n">No</span> <span class="n">pinentry</span>
<span class="nl">gpg:</span> <span class="n">problem</span> <span class="n">with</span> <span class="n">the</span> <span class="n">agent</span><span class="o">:</span> <span class="n">No</span> <span class="n">pinentry</span>
<span class="nl">gpg:</span> <span class="n">Key</span> <span class="n">generation</span> <span class="n">canceled</span><span class="p">.</span>
</pre></div>


<h3>Workaround</h3>
<p>In order to work around the above TTY issue, you will need to use X11
forwarding when switching to a different user.  To do this, you need an
<em>export</em> file in root's <strong>.xauth</strong> directory.</p>
<p>First, switch to root:</p>
<div class="highlight"><pre><span class="n">su</span> <span class="o">-</span>
</pre></div>


<p>Then, create an export file with the user you want to switch to, for example,
<strong>user1</strong>:</p>
<div class="highlight"><pre>cd $HOME
mkdir -p .xauth
echo &quot;user1&quot; &gt;&gt; .xauth/export
</pre></div>


<p>Switch to <strong>user1</strong>:</p>
<div class="highlight"><pre><span class="n">su</span> <span class="o">-</span> <span class="n">user1</span>
</pre></div>


<p>Now, if you try to generate gpg keys, pinentry will present the passphrase
prompt.</p>
<h2>Distributing the Public Key</h2>
<p>If you plan to distribute custom built RPMs to multiple or even all machines in your
environment, you will need to distribute the public key to all machines and
import it into each machine's local RPM database.</p>
<h3>Export the Signing Key</h3>
<p>We need to export the signing key into ASCII armored output, which is a form of
binary-to-text encoding.  We need the <em>name</em> of the key in order to export it.</p>
<p>Get a list of keys:</p>
<div class="highlight"><pre><span class="n">gpg</span> <span class="o">--</span><span class="n">list</span><span class="o">-</span><span class="n">keys</span>
</pre></div>


<p>The output, as seen above, should similar to the following:</p>
<div class="highlight"><pre>/home/makerpm/.gnupg/pubring.gpg
---------------------------------
pub   2048R/3D832D1E 2015-05-29
uid                  Example Org Signing Key &lt;support@example.com&gt;
sub   2048R/D4F51F8B 2015-05-29
</pre></div>


<p>The <em>name</em> is in the <em>uid</em> line, before the email address.  In this case, it is
<strong>Example Org Signing Key</strong>.  Use gpg to export this key in ASCII armored
output to a file:</p>
<div class="highlight"><pre><span class="n">gpg</span> <span class="o">--</span><span class="n">export</span> <span class="o">-</span><span class="n">a</span> <span class="s">&quot;Example Org Signing Key&quot;</span> <span class="o">&gt;</span> <span class="n">RPM</span><span class="o">-</span><span class="n">GPG</span><span class="o">-</span><span class="n">KEY</span><span class="o">-</span><span class="n">example</span><span class="o">-</span><span class="n">org</span><span class="o">-</span><span class="n">signing</span><span class="o">-</span><span class="n">key</span>
</pre></div>


<p>The resulting file, <strong>RPM-GPG-KEY-example-org-signing-key</strong>, is the RPM signing
key that we can distribute to other machines.</p>
<h3>Importing the Key into the RPM database</h3>
<p>On RHEL 6 and its clones, the default location on the filesystem for RPM GPG
keys are <strong>/etc/pki/rpm-gpg</strong>.  Use your tool of choice, such as scp, rsync,
Puppet, Ansible, etc., to copy the file to any remote machine where you will
install custom RPMs signed with this key.</p>
<p>If SELinux is in <em>Enforcing</em> mode, be sure that the TYPE in the target security
context is <strong>cert_t</strong>. Use the <strong>ls</strong> command to view the SELinux context of
the key file</p>
<div class="highlight"><pre><span class="n">ls</span> <span class="o">-</span><span class="n">lZ</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">rpm</span><span class="o">-</span><span class="n">gpg</span><span class="o">/</span><span class="n">RPM</span><span class="o">-</span><span class="n">GPG</span><span class="o">-</span><span class="n">KEY</span><span class="o">-</span><span class="n">example</span><span class="o">-</span><span class="n">org</span><span class="o">-</span><span class="n">signing</span><span class="o">-</span><span class="n">key</span>
</pre></div>


<p>The output should look something similar to the following:</p>
<div class="highlight"><pre><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span><span class="p">.</span> <span class="n">root</span> <span class="n">root</span> <span class="n">unconfined_u</span><span class="o">:</span><span class="n">object_r</span><span class="o">:</span><span class="kt">cert_t</span><span class="o">:</span><span class="n">s0</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">rpm</span><span class="o">-</span><span class="n">gpg</span><span class="o">/</span><span class="n">RPM</span><span class="o">-</span><span class="n">GPG</span><span class="o">-</span><span class="n">KEY</span><span class="o">-</span><span class="n">example</span><span class="o">-</span><span class="n">org</span><span class="o">-</span><span class="n">signing</span><span class="o">-</span><span class="n">key</span>
</pre></div>


<p>Lastly, import the key into the RPM database on all machines where you copied
the key. This command will not return any output and exit with return code <strong>0</strong>.</p>
<div class="highlight"><pre>rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-example-org-signing-key
</pre></div>


<h3>Verify Key Import</h3>
<p>To verify that the key has been imported, we can search the RPM database.
First, we need the public GPG key id.  In the output of <strong>gpg --list-keys</strong>,
the public key id is found in the <strong>pub</strong> line.  It is the 8 hex digits after
the slash.  The size of the key, <em>2048</em>, and the algorithm, <em>R</em> for RSA, is
shown before the slash on the <strong>pub</strong> line.</p>
<div class="highlight"><pre>pub   2048R/3D832D1E 2015-05-29
</pre></div>


<p>Then, use the <strong>rpm</strong> command to find the public key.  </p>
<div class="highlight"><pre><span class="n">rpm</span> <span class="o">-</span><span class="n">qa</span> <span class="n">gpg</span><span class="o">-</span><span class="n">pubkey</span><span class="err">\</span><span class="o">*</span>
</pre></div>


<p>The output will show all GPG keys that have been imported into the RPM
database.  You should see your public key ID, in lowercase, in one of the pubkeys listed:</p>
<div class="highlight"><pre><span class="n">gpg</span><span class="o">-</span><span class="n">pubkey</span><span class="o">-</span><span class="mi">3</span><span class="n">d832d1e</span><span class="o">-</span><span class="mf">556873e0</span>
</pre></div>


<p>Finally, use <strong>rpm</strong> command again to see more information about the key:</p>
<div class="highlight"><pre><span class="n">rpm</span> <span class="o">-</span><span class="n">qi</span> <span class="n">gpg</span><span class="o">-</span><span class="n">pubkey</span><span class="o">-</span><span class="mi">3</span><span class="n">d832d1e</span><span class="o">-</span><span class="mf">556873e0</span>
</pre></div>


<p>The output should look similar to the following:</p>
<div class="highlight"><pre>Name        : gpg-pubkey                   Relocations: (not relocatable)
Version     : 3d832d1e                          Vendor: (none)
Release     : 556873e0                      Build Date: Fri 29 May 2015 08:13:22 PM EDT
Install Date: Fri 29 May 2015 08:13:22 PM EDT      Build Host: localhost
Group       : Public Keys                   Source RPM: (none)
Size        : 0                                License: pubkey
Signature   : (none)
Summary     : gpg(Example Org Signing Key &lt;support@example.com&gt;)
Description :
-----BEGIN PGP PUBLIC KEY BLOCK-----
...
</pre></div>


<h2>Conclusion</h2>
<p>You now have an RPM GPG key that you can use sign and verify custom RPMs.  In
Part 3 of this guide, we will look at various ways of building RPMs.</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Part 2 of the Building RPMs series</h4>
       <h5>Previous articles</h5>
       <ul>
           <li><a href="http://giovannitorres.me/how-to-setup-an-rpm-build-environment-on-centos-6.html">How to Setup an RPM Build Environment on CentOS 6</a></li>
       </ul>
       <h5>Next articles</h5>
       <ul>
           <li><a href="http://giovannitorres.me/how-to-build-rpms-collectd-example.html">How to Build RPMs - Collectd Example</a></li>
           <li><a href="http://giovannitorres.me/signing-rpms.html">Signing RPMs</a></li>
       </ul>
</section>
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'giovannitorres'; // required: replace example with your forum shortname

                    var disqus_identifier = 'how-to-setup-an-rpm-signing-key';
                var disqus_url = 'http://giovannitorres.me/how-to-setup-an-rpm-signing-key.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">

            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
                <ul class="list-group" id="recentposts">
                    <li class="list-group-item">
                        <a href="http://giovannitorres.me/signing-rpms.html">
                            Signing RPMs
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://giovannitorres.me/how-to-build-rpms-collectd-example.html">
                            How to Build RPMs - Collectd Example
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://giovannitorres.me/troubleshooting-slow-rsh-logins-with-strace-on-centos-6.html">
                            Troubleshooting slow rsh logins with strace on CentOS 6
                        </a>
                    </li>
                </ul>
            </li>

            <li class="list-group-item"><a href="http://giovannitorres.me/"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4></a>
                <ul class="list-group" id="categories">
                    <li class="list-group-item">
                        <a href="http://giovannitorres.me/category/collectd.html">
                            <i class="fa fa-folder-open fa-lg"></i> Collectd
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://giovannitorres.me/category/linux.html">
                            <i class="fa fa-folder-open fa-lg"></i> Linux
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://giovannitorres.me/category/rpm.html">
                            <i class="fa fa-folder-open fa-lg"></i> RPM
                        </a>
                    </li>
                </ul>
            </li>

            <li class="list-group-item"><a href="http://giovannitorres.me/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group " id="tags">
                </ul>
            </li>



    <li class="list-group-item"><h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2015 Giovanni Torres
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://giovannitorres.me/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://giovannitorres.me/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://giovannitorres.me/theme/js/respond.min.js"></script>

    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = 'http://giovannitorres.me/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'giovtorres',
                count: 5,
                skip_forks: true,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="http://giovannitorres.me/theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'giovannitorres'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-54838714-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

</body>
</html>